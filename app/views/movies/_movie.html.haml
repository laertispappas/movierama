.panel.movie
  .header.row
    .left.columns.small-12
      %h3.text-center
        = link_to_unless_current movie.title, movie_path(movie)
    .right
      - if user_signed_in? and current_user == movie.user
        = link_to '[Edit]', edit_movie_path(movie)
    %hr
  .row
    .small-12.columns
      %h5
        Posted by
        - if user_signed_in? and movie.user == current_user
          = link_to 'You', user_movies_path(movie.user.id)
        - else
          = link_to movie.user.fullname, user_movies_path(movie.user.id)
        %small
          = time_ago_in_words movie.created_at
          ago
  .row
    .small-12.columns
      %p
        = simple_format movie.description
    .small-12.columns
      .movie-footer{class: "movie-#{movie.id}"}
        %hr
        - if user_signed_in?
          - liked = false # flags to check if users has liked or hated a movie.
          - hated = false
          .left
            - # if this movie is current users movie show likes and hates with no link to vote
            - if movie.user == current_user # && movie.cached_votes_total > 0  uncomment this if we want to hide counter for 0 votes
              = pluralize(movie.cached_votes_up, 'like')
              = pluralize(movie.cached_votes_down, 'hate')
            - else # movie is not created by current user
              #votes
                - if(movie.cached_votes_total == 0)    # if no votes yet be the first to vote
                  %span#be-the-first
                    Be the first to vote this movie:
                  %span#likes
                    = link_to 'like', like_movie_path(movie), method: :put, remote: true
                  %span#hates
                    = link_to 'hate', hate_movie_path(movie), method: :put, remote: true
                - else # movie has some votes show likes and hates
                  - if @current_user_movie_likes_ids.include?(movie.id)
                    - liked = true
                    - hated = false
                  - elsif @current_user_movie_hates_ids.include?(movie.id)
                    - liked = false
                    - hated = true
                  %span#likes
                    = link_to_if !liked, pluralize(movie.cached_votes_up, 'like'), like_movie_path(movie), method: :put, remote: true
                  %span#hates
                    = link_to_if !hated, pluralize(movie.cached_votes_down, 'hate'), hate_movie_path(movie), method: :put, remote: true
          .right#unvote
            %span#unvote-text
            - if liked  # if current user has liked this movie
              You like this movie
              |
              = link_to 'Unlike', unvote_movie_path(movie), method: :put, id: 'unvote-link', remote: true
            - elsif hated
              You hate this movie
              |
              = link_to 'Unhate', unvote_movie_path(movie), method: :put, id: 'unvote-link', remote: true
        - else  # not signed in
          - if movie.cached_votes_total > 0
            = pluralize(movie.cached_votes_up, 'like')
            = pluralize(movie.cached_votes_down, 'hate')